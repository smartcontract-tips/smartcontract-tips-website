---
layout: post
title: 'ZkSync-based Lending Protocol EraLend Under Attack: $3.4M Loss Uncovered'
date: 2023-07-29 11:21:31.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- English
- Incident Report
tags: []
meta:
  _wpas_done_all: '1'
  _thumbnail_id: '6212'
  _edit_last: '48926058'
  ppma_authors_name: Davide
author:
  login: divisionista
  email: dcarboni@gmail.com
  display_name: Davide
  first_name: Davide
  last_name: ''
permalink: "/articoli/zksync-based-lending-protocol-eralend-under-attack-34m-loss-uncovered/"
excerpt: EraLend, a leading decentralized lending protocol operating on the zkSync
  Layer 2 network, has fallen victim to a ‚Äòread-only reentrancy attack,‚Äô leading to
  a significant loss of $3.4 million. EraLend is a trailblazer in the DeFi lending
  market, offering a state-of-the-art protocol that prioritizes capital efficiency
  and risk reduction. Powered by zkSync, EraLend supports nearly all crypto tokens,
  facilitating peer-to-peer lending with exceptional speed and minimal costs.
featured_image: featured_images/Screenshot2023-07-29at12.45.54.png
---
<div class="<br />
          image-block-outer-wrapper<br />
          layout-caption-below<br />
          design-layout-inline<br />
          combination-animation-site-default<br />
          individual-animation-site-default<br />
          individual-text-animation-site-default<br />
        " data-test="image-block-inline-outer-wrapper"><br />
<figure class="<br />
              sqs-block-image-figure<br />
              intrinsic<br />
            " style="max-width:728px;">
<div class="image-block-wrapper" data-animation-role="image">
<div class="sqs-image-shape-container-element</p>
<p>              has-aspect-ratio<br />
            " style="<br />
                position: relative;</p>
<p>                  padding-bottom:55.4945068359375%;</p>
<p>                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);<br />
              "></p></div>
</div>
<p><img data-stretch="false" src="{{ site.baseurl }}/assets/2023/07/Eraland+hacked+for+3.4+millions" data-image="https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/6c4fa42f-7870-44cf-a3e9-94ee65f5dca4/Eraland+hacked+for+3.4+millions" data-image-dimensions="728x404" data-image-focal-point="0.5,0.5" alt="" data-load="false" width="728" height="404" sizes="100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" srcset="https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/6c4fa42f-7870-44cf-a3e9-94ee65f5dca4/Eraland+hacked+for+3.4+millions?format=100w 100w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/6c4fa42f-7870-44cf-a3e9-94ee65f5dca4/Eraland+hacked+for+3.4+millions?format=300w 300w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/6c4fa42f-7870-44cf-a3e9-94ee65f5dca4/Eraland+hacked+for+3.4+millions?format=500w 500w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/6c4fa42f-7870-44cf-a3e9-94ee65f5dca4/Eraland+hacked+for+3.4+millions?format=750w 750w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/6c4fa42f-7870-44cf-a3e9-94ee65f5dca4/Eraland+hacked+for+3.4+millions?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/6c4fa42f-7870-44cf-a3e9-94ee65f5dca4/Eraland+hacked+for+3.4+millions?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/6c4fa42f-7870-44cf-a3e9-94ee65f5dca4/Eraland+hacked+for+3.4+millions?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" /></p>
</figure>
</div>
<div class="sqs-html-content">
<h2 style="white-space:pre-wrap;">Overview</h2>
<p class="sqsrte-large" style="white-space:pre-wrap;">EraLend, a leading decentralized lending protocol operating on the zkSync Layer 2 network, has fallen victim to a ‚Äòread-only reentrancy attack,‚Äô leading to a significant loss of $3.4 million.</p>
<h2 style="white-space:pre-wrap;">About EraLend</h2>
<p class="sqsrte-large" style="white-space:pre-wrap;">EraLend is a trailblazer in the DeFi lending market, offering a state-of-the-art protocol that prioritizes capital efficiency and risk reduction. Powered by zkSync, EraLend supports nearly all crypto tokens, facilitating peer-to-peer lending with exceptional speed and minimal costs. EraLend is pioneering the first native suite of lending products on zkSync, setting its sights on propelling DeFi mass adoption. Through these groundbreaking endeavors, EraLend is redefining standards and shaping the future of finance.</p>
<h2 style="white-space:pre-wrap;">About the attack</h2>
<p class="sqsrte-large" style="white-space:pre-wrap;">The attacker capitalized on a vulnerability within the smart contract code that allowed them to perform repeated calls to a function within a single transaction. This allowed them to withdraw more funds than they were entitled to, depleting resources in two distinct transactions using an externally owned account.</p>
</div>
<div class="<br />
          image-block-outer-wrapper<br />
          layout-caption-below<br />
          design-layout-inline<br />
          combination-animation-site-default<br />
          individual-animation-site-default<br />
          individual-text-animation-site-default<br />
        " data-test="image-block-inline-outer-wrapper"><br />
<figure class="<br />
              sqs-block-image-figure<br />
              intrinsic<br />
            " style="max-width:727px;">
<div class="image-block-wrapper" data-animation-role="image">
<div class="sqs-image-shape-container-element</p>
<p>              has-aspect-ratio<br />
            " style="<br />
                position: relative;</p>
<p>                  padding-bottom:47.867950439453125%;</p>
<p>                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);<br />
              "></p></div>
</div>
<p><img data-stretch="false" src="{{ site.baseurl }}/assets/2023/07/transactions+for+eralend+hack+for+3.4+millions" data-image="https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/19f1d73b-0158-4fce-84df-6340084e1fc9/transactions+for+eralend+hack+for+3.4+millions" data-image-dimensions="727x348" data-image-focal-point="0.5,0.5" alt="" data-load="false" width="727" height="348" sizes="100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" srcset="https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/19f1d73b-0158-4fce-84df-6340084e1fc9/transactions+for+eralend+hack+for+3.4+millions?format=100w 100w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/19f1d73b-0158-4fce-84df-6340084e1fc9/transactions+for+eralend+hack+for+3.4+millions?format=300w 300w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/19f1d73b-0158-4fce-84df-6340084e1fc9/transactions+for+eralend+hack+for+3.4+millions?format=500w 500w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/19f1d73b-0158-4fce-84df-6340084e1fc9/transactions+for+eralend+hack+for+3.4+millions?format=750w 750w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/19f1d73b-0158-4fce-84df-6340084e1fc9/transactions+for+eralend+hack+for+3.4+millions?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/19f1d73b-0158-4fce-84df-6340084e1fc9/transactions+for+eralend+hack+for+3.4+millions?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/640a182d9182d66162be74d6/19f1d73b-0158-4fce-84df-6340084e1fc9/transactions+for+eralend+hack+for+3.4+millions?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" /></p>
</figure>
</div>
<div class="sqs-html-content">
<p class="sqsrte-large" style="white-space:pre-wrap;">Notably, the exploit involved manipulating a contract to report outdated values that hadn‚Äôt yet been updated. Consequently, this had repercussions on the stablecoin USDC+, issued by the Overnight Finance protocol, resulting in a potential loss of over $261,000, which represents approximately 7.86% of the total value of the collateral supporting the stablecoin. EraLend tweeted about the exploit to inform users:</p>
<blockquote><p class="sqsrte-large" style="white-space:pre-wrap;"><span class="sqsrte-text-color--custom" style="color: rgb(109, 108, 108)">üö®Security Update: We've experienced a security incident on our platform today. The threat has been contained. We've suspended all borrowing operations for now and advise against depositing USDC. We're working with partners and cybersecurity firms to address this. <br />More updates‚Ä¶</span></p>
<p class="sqsrte-large" style="white-space:pre-wrap;"><span class="sqsrte-text-color--custom" style="color: rgb(109, 108, 108)">‚Äî EraLend | The #1 Money Market on zkSyncü•á (@Era_Lend) </span><a href="https://twitter.com/Era_Lend/status/1683826465446715397?ref_src=twsrc%5Etfw" target="_blank" rel="noopener"><span class="sqsrte-text-color--custom" style="color: rgb(109, 108, 108)">July 25, 2023</span></a></p>
</blockquote>
<p class="sqsrte-large" style="white-space:pre-wrap;">In response to the attack, EraLend took immediate action by suspending the protocol‚Äôs zkSync contracts to mitigate further exploits. They also advised users against depositing USDC until the issue had been resolved. Borrowing operations on the platform have also been temporarily halted as the team works with cybersecurity firms to address this issue.</p>
<p class="sqsrte-large" style="white-space:pre-wrap;">The attack strategy leveraged was a ‚Äúread-only reentrancy attack," a method that doesn‚Äôt alter the status of a contract but managed to drain a substantial amount of money from the platform. The attacker managed to trick the contract into reporting out-of-date values using a flaw in ‚Äúthe callback and _updateReserves function.‚Äù</p>
<blockquote><p class="sqsrte-large" style="white-space:pre-wrap;"><span class="sqsrte-text-color--custom" style="color: #6D6C6C">We are assisting </span><a href="https://twitter.com/Era_Lend?ref_src=twsrc%5Etfw" target="_blank" rel="noopener"><span class="sqsrte-text-color--custom" style="color: #6D6C6C">@Era_Lend</span></a><span class="sqsrte-text-color--custom" style="color: #6D6C6C"> to this issue, and the root cause has been identified. The total loss is ~$3.4M.<br />Specifically, this is a read-only re-entrancy attack.<br />Another attack tx is:</span><a href="https://t.co/H4A2suVLai" target="_blank" rel="noopener"><span class="sqsrte-text-color--custom" style="color: #6D6C6C">https://t.co/H4A2suVLai</span></a><span class="sqsrte-text-color--custom" style="color: #6D6C6C"><br />Attacker address:<br />0xf1D076c9Be4533086f967e14EE6aFf204D5ECE7a </span><a href="https://t.co/InhCCW7QAy" target="_blank" rel="noopener"><span class="sqsrte-text-color--custom" style="color: #6D6C6C">https://t.co/InhCCW7QAy</span></a></p>
<p class="sqsrte-large" style="white-space:pre-wrap;"><span class="sqsrte-text-color--custom" style="color: #6D6C6C">‚Äî BlockSec (@BlockSecTeam) </span><a href="https://twitter.com/BlockSecTeam/status/1683824959452504065?ref_src=twsrc%5Etfw" target="_blank" rel="noopener"><span class="sqsrte-text-color--custom" style="color: #6D6C6C">July 25, 2023</span></a></p>
</blockquote>
<p class="sqsrte-large" style="white-space:pre-wrap;">EraLend is resolute in its commitment to bolstering its security infrastructure to safeguard user funds and restore the confidence of its community. Despite the attack, the company remains committed to its ambitious plan to establish an ecosystem of interoperable chains named ‚ÄúHyperchains‚Äù by December 2023.</p>
<h2 style="white-space:pre-wrap;"><span class="sqsrte-text-color--accent">More on the attack</span></h2>
<p class="sqsrte-large" style="white-space:pre-wrap;">The attack on EraLend primarily exploited the LP (Liquidity Pool) tokens as collateral. The attacker was able to manipulate LP token pricing, leading to significant losses. The exploit may have occurred due to EraLend allowing these LP tokens as collateral</p>
<p class="sqsrte-large" style="white-space:pre-wrap;">Moreover, the attack on EraLend had a ripple effect on other platforms within the ecosystem, most notably <a href="http://overnight.fi/" target="_blank" rel="noopener">Overnight.fi</a>. The latter utilized EraLend similarly to Aave elsewhere, where they borrowed ETH against USDC and provided delta-neutral LP positions on <a href="http://mute.io/" target="_blank" rel="noopener">Mute.io</a>. As a result of the exploit, <a href="http://overnight.fi/" target="_blank" rel="noopener">Overnight.fi</a>‚Äôs USDC/ETH LP position on <a href="http://mute.io/" target="_blank" rel="noopener">Mute.io</a>, tied to EraLend, saw a drop in value, prompting users to sell their holdings on the platform. <a href="http://overnight.fi/" target="_blank" rel="noopener">Overnight.fi</a> has since paused USD+ on zkSync and is working with EraLend to maximize recovery efforts.</p>
<p class="sqsrte-large" style="white-space:pre-wrap;">Furthermore, Peckshield, a blockchain security service, confirmed a price oracle issue related to the exploit. This tool, critical for determining current market prices, faced disruptions due to the attack, leading to inconsistencies in its calculations.</p>
<h2 style="white-space:pre-wrap;">Aftermath of the Attack</h2>
<p class="sqsrte-large" style="white-space:pre-wrap;">While the total loss incurred by EraLend amounts to approximately $3.4 million, a secondary attack transaction involving $1 million USDC has been reported. This raises concerns about potential further losses, underscoring the gravity of the situation.</p>
<p class="sqsrte-large" style="white-space:pre-wrap;">EraLend, after identifying the exploit, quickly issued a statement acknowledging the security incident and assuring its users that the threat had been contained. The protocol suspended all borrowing operations and advised users against depositing USDC until the situation had been resolved. EraLend also reassured its users that all assets other than USDC remained secure.</p>
<p class="sqsrte-large" style="white-space:pre-wrap;">However, this incident has raised concerns over the potential vulnerabilities that may exist within the broader DeFi ecosystem. It serves as a potent reminder of the importance of robust security measures and constant vigilance in the world of decentralized finance.</p>
<h2 style="white-space:pre-wrap;">Prevention of Future Attacks</h2>
<p class="sqsrte-large" style="white-space:pre-wrap;">In the aftermath of the attack, developers and industry experts highlighted the importance of implementing proper coding techniques to prevent such security breaches. One such preventive measure is a technique called ‚Äúchecks-effects-interactions,‚Äù which ensures that a smart contract always checks all the inputs and conditions before executing any state changes, then executes all state changes before interacting with any other contracts.</p>
<p class="sqsrte-large" style="white-space:pre-wrap;">Through this incident, EraLend has shown commitment to maintaining the highest security standards and taking proactive measures to safeguard its users‚Äô funds. The protocol is working with partners and cybersecurity firms to address the issues and mitigate the impact of the attack. EraLend‚Äôs commitment to strengthening its security infrastructure, despite the setback, reinforces the protocol‚Äôs dedication to its user community and the broader DeFi ecosystem.</p>
<h2 style="white-space:pre-wrap;">Conclusion</h2>
<p class="sqsrte-large" style="white-space:pre-wrap;">In conclusion, the recent EraLend exploit underscores the urgent need for enhanced security measures in DeFi. Despite the setback, EraLend remains steadfast in bolstering its protocols to safeguard users. The incident not only challenges EraLend but also serves as a stark reminder for the broader DeFi ecosystem about potential vulnerabilities.</p>
</div>
